<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Voucher Manager</title>
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
        body { display: none; }
        .container { max-width: 900px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; color: white; font-size: 0.95rem; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { background: rgba(255,255,255,0.05); font-weight: 600; color: var(--primary); }
        tr:hover { background: rgba(255,255,255,0.02); }
        td { color: #cbd5e1; }
        /* Scrollbar for table */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }
        
        .reset-btn {
            background: #ef4444; 
            margin-top: 20px;
            font-size: 0.9rem;
            padding: 10px 20px;
        }
        .reset-btn:hover {
            box-shadow: 0 10px 20px rgba(239, 68, 68, 0.3);
        }
    </style>
  </head>
  <body>
    <div class="background-blobs">
      <div class="blob blob-1"></div>
      <div class="blob blob-2"></div>
      <div class="blob blob-3"></div>
    </div>

    <div class="container">
      <div class="card">
        <h1>Admin Dashboard</h1>
        <p class="subtitle">
        </p>

        <div style="overflow-x: auto;">
            <table id="submissionsTable">
                <thead>
                    <tr>
                        <th>Waktu</th>
                        <th>Nama User</th>
                        <th>No. Kontak</th>
                        <th>Hadiah Didapat</th>
                        <th>Ref ID</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="5" style="text-align: center;">Memuat data...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        </div>
      </div>
    </div>

    <script>
        
        // Hash dari "onlyadmin" (Verified by User)
        const HASH_RAHASIA = "67d0105d180f8a353ae8e308a66d4ce3fe2cb404ab6f8505b05ed1003a8f98ae"; 

        (async () => {
            let input = prompt("Masukkan Password Admin:");
            
            if(!input) {
                window.location.href = "index.html"; 
                return;
            }

            const inputHash = await sha256(input);
            
            if(inputHash === HASH_RAHASIA) {
                document.body.style.display = "flex";
            } else {
                alert("Password Salah!");
                window.location.href = "index.html"; 
            }
        })();

   
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest("SHA-256", msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, "0")).join("");
        }

        const BASE_URL = "https://script.google.com/macros/s/AKfycbwXguaq9HM2DHXjb5SG5ceFAzR5vVZPHrMdpk199RR7e8XAYOt9c9MTUBgoB0brL_U/exec";

        document.addEventListener("DOMContentLoaded", () => {
            loadData();
        });

        async function loadData() {
            const tbody = document.querySelector('#submissionsTable tbody');
            tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Sedang mengambil data terbaru...</td></tr>';

            try {
             
                const response = await fetch(`${BASE_URL}?type=dashboard`);
                const data = await response.json();
                
                tbody.innerHTML = '';
                
                if(!data || data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Belum ada data submit.</td></tr>';
                    return;
                }

               
                data.reverse().forEach(sub => {
                    const row = document.createElement('tr');
                    
                    // Format Date
                    let dateStr = "-";
                    if(sub.timestamp) {
                        const dateObj = new Date(sub.timestamp);
                        dateStr = dateObj.toLocaleString('id-ID', {
                            day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit'
                        });
                    }
                    
                    // Format Prize Color
                    const prizeText = sub.prize || "-";
                    const prizeStyle = prizeText.includes('ZONK') ? 'color: #f87171;' : 'color: #4ade80; font-weight: bold;';

                    row.innerHTML = `
                        <td>${dateStr}</td>
                        <td style="font-weight: 500; color: white;">${sub.name}</td>
                        <td>${sub.phone}</td>
                        <td style="${prizeStyle}">${prizeText}</td>
                        <td><code style="background: rgba(255,255,255,0.1); padding: 2px 5px; border-radius: 4px;">${sub.refId || '-'}</code></td>
                    `;
                    tbody.appendChild(row);
                });

            } catch (error) {
                console.error("Gagal load data:", error);
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #f87171;">Gagal mengambil data dari Google Sheet.</td></tr>';
            }
        }
    </script>
  </body>
</html>
